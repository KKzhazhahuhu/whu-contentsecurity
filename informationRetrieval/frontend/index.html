<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µå•†ä¿¡æ¯æ£€ç´¢ç³»ç»Ÿ (æ··åˆæ£€ç´¢ç‰ˆ)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 20px;
            color: #2c3e50;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            font-weight: 300;
        }

        .features {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            font-size: 0.9em;
            flex-wrap: wrap;
        }

        .feature-tag {
            background: rgba(255,255,255,0.15);
            padding: 6px 14px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .feature-tag.disabled {
            background: rgba(255,255,255,0.08);
            opacity: 0.6;
        }

        .search-section {
            padding: 30px;
            background: #fafbfc;
            border-bottom: 1px solid #e9ecef;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
        }

        .search-input:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .search-btn {
            padding: 15px 30px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .search-btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .search-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .option-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .option-group label {
            font-weight: 500;
            color: #2c3e50;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #3498db;
        }

        .checkbox-group label {
            font-weight: 400;
            color: #555;
        }

        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e9ecef;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: none;
        }

        .slider-value {
            font-size: 12px;
            color: #7f8c8d;
            text-align: center;
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-weight: 500;
            color: #2c3e50;
        }

        .filter-input {
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        .filter-input:focus {
            border-color: #3498db;
            outline: none;
        }

        .query-info {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .query-info.show {
            display: block;
        }

        .correction-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .expansion-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .hybrid-info {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .results {
            padding: 0 30px 30px;
        }

        .result-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.2s ease;
        }

        .result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            border-color: #3498db;
        }

        .result-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .result-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #7f8c8d;
            flex-wrap: wrap;
        }

        .result-description {
            color: #555;
            line-height: 1.6;
        }

        .score-badge {
            background: #3498db;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .search-type-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .hybrid-badge {
            background: #d4edda;
            color: #155724;
        }

        .keyword-badge {
            background: #fff3cd;
            color: #856404;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #7f8c8d;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        .comparison-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
            border: 1px solid #e9ecef;
        }

        .comparison-section.show {
            display: block;
        }

        .comparison-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
            transition: background 0.2s ease;
        }

        .comparison-btn:hover {
            background: #5a6268;
        }

        .debug-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
            border: 1px solid #e9ecef;
        }

        .debug-section.show {
            display: block;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        .tab-container {
            margin-top: 20px;
        }

        .tab-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tab-btn {
            padding: 8px 16px;
            background: #e9ecef;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s ease;
        }

        .tab-btn.active {
            background: #3498db;
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: #dee2e6;
        }

        .tab-content {
            display: none;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .tab-content.active {
            display: block;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .search-section {
                padding: 20px;
            }

            .results {
                padding: 0 20px 20px;
            }

            .search-box {
                flex-direction: column;
            }

            .search-options {
                grid-template-columns: 1fr;
            }

            .filters {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ç”µå•†ä¿¡æ¯æ£€ç´¢ç³»ç»Ÿ</h1>
            <p>æ··åˆæ£€ç´¢ Â· æ™ºèƒ½æœç´¢ Â· è¯­ä¹‰ç†è§£</p>
            <div class="features" id="features">
                <div class="feature-tag">ğŸ” å…³é”®è¯æœç´¢</div>
                <div class="feature-tag" id="semanticFeature">ğŸ§  è¯­ä¹‰æœç´¢</div>
                <div class="feature-tag">ğŸ”„ æ··åˆæ£€ç´¢</div>
                <div class="feature-tag">âœï¸ æ‹¼å†™çº é”™</div>
                <div class="feature-tag">ğŸ”— åŒä¹‰è¯æ‰©å±•</div>
            </div>
        </div>

        <div class="search-section">
            <div class="search-box">
                <input type="text" id="searchInput" class="search-input" placeholder="è¾“å…¥æ‚¨è¦æœç´¢çš„å•†å“...">
                <button onclick="search()" class="search-btn">ğŸ” æœç´¢</button>
                <button onclick="compareSearch()" class="comparison-btn">å¯¹æ¯”</button>
                <button onclick="toggleDebug()" class="comparison-btn">è°ƒè¯•</button>
            </div>

            <div class="search-options">
                <div class="option-group">
                    <label><strong>æœç´¢æ¨¡å¼</strong></label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="useHybrid" checked>
                        <label for="useHybrid">å¯ç”¨æ··åˆæ£€ç´¢</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="enableSpellCheck" checked>
                        <label for="enableSpellCheck">å¯ç”¨æ‹¼å†™çº é”™</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="enableSynonymExpansion" checked>
                        <label for="enableSynonymExpansion">å¯ç”¨åŒä¹‰è¯æ‰©å±•</label>
                    </div>
                </div>

                <div class="option-group">
                    <label><strong>æƒé‡è°ƒèŠ‚</strong></label>
                    <div class="slider-group">
                        <label>å…³é”®è¯æƒé‡: <span id="keywordWeightValue">0.6</span></label>
                        <input type="range" id="keywordWeight" class="slider" min="0" max="1" step="0.1" value="0.6">
                        <div class="slider-value">è¯­ä¹‰æƒé‡: <span id="semanticWeightValue">0.4</span></div>
                    </div>
                </div>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <label>æœ€ä½ä»·æ ¼</label>
                    <input type="number" id="priceMin" class="filter-input" placeholder="0">
                </div>
                <div class="filter-group">
                    <label>æœ€é«˜ä»·æ ¼</label>
                    <input type="number" id="priceMax" class="filter-input" placeholder="æ— é™åˆ¶">
                </div>
                <div class="filter-group">
                    <label>åˆ†ç±»ç­›é€‰</label>
                    <input type="text" id="category" class="filter-input" placeholder="è¾“å…¥åˆ†ç±»">
                </div>
                <div class="filter-group">
                    <label>ç»“æœæ•°é‡</label>
                    <select id="topK" class="filter-input">
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                    </select>
                </div>
            </div>

            <div id="queryInfo" class="query-info"></div>

            <div class="comparison-section" id="comparisonSection">
                <h3>æœç´¢æ–¹æ³•å¯¹æ¯”</h3>
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" onclick="showTab('keyword')">å…³é”®è¯æœç´¢</button>
                        <button class="tab-btn" onclick="showTab('hybrid')" id="hybridTab">æ··åˆæ£€ç´¢</button>
                        <button class="tab-btn" onclick="showTab('enhanced')">å¢å¼ºæœç´¢</button>
                    </div>
                    <div id="keywordTab" class="tab-content active"></div>
                    <div id="hybridTabContent" class="tab-content"></div>
                    <div id="enhancedTab" class="tab-content"></div>
                </div>
            </div>

            <div class="debug-section" id="debugSection">
                <h3>è°ƒè¯•ä¿¡æ¯</h3>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalProducts">-</div>
                        <div class="stat-label">å•†å“æ€»æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="searchTime">-</div>
                        <div class="stat-label">æœç´¢è€—æ—¶(ms)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="searchStrategy">-</div>
                        <div class="stat-label">æœç´¢ç­–ç•¥</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="searchCapabilities">-</div>
                        <div class="stat-label">å¯ç”¨åŠŸèƒ½</div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <button onclick="testSpellCheck()" class="comparison-btn">æµ‹è¯•æ‹¼å†™æ£€æŸ¥</button>
                    <button onclick="showSynonyms()" class="comparison-btn">æŸ¥çœ‹åŒä¹‰è¯</button>
                    <button onclick="getCapabilities()" class="comparison-btn">æ£€æŸ¥èƒ½åŠ›</button>
                </div>
                <div id="debugOutput" style="margin-top: 15px; padding: 10px; background: white; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; border: 1px solid #e9ecef;"></div>
            </div>
        </div>

        <div class="results" id="results"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let searchStartTime = 0;
        let searchCapabilities = {};

        // æƒé‡æ»‘å—è”åŠ¨
        document.getElementById('keywordWeight').addEventListener('input', function(e) {
            const keywordWeight = parseFloat(e.target.value);
            const semanticWeight = 1.0 - keywordWeight;
            document.getElementById('keywordWeightValue').textContent = keywordWeight.toFixed(1);
            document.getElementById('semanticWeightValue').textContent = semanticWeight.toFixed(1);
        });

        async function search() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }

            const resultsDiv = document.getElementById('results');
            const queryInfoDiv = document.getElementById('queryInfo');

            resultsDiv.innerHTML = '<div class="loading">æœç´¢ä¸­...</div>';
            queryInfoDiv.className = 'query-info';

            searchStartTime = Date.now();

            try {
                const filters = {};

                const priceMin = document.getElementById('priceMin').value;
                const priceMax = document.getElementById('priceMax').value;
                const category = document.getElementById('category').value;

                if (priceMin) filters.price_min = parseFloat(priceMin);
                if (priceMax) filters.price_max = parseFloat(priceMax);
                if (category) filters.category = category;

                const response = await fetch(`${API_BASE}/api/search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: query,
                        top_k: parseInt(document.getElementById('topK').value),
                        filters: filters,
                        enable_spell_correction: document.getElementById('enableSpellCheck').checked,
                        enable_synonym_expansion: document.getElementById('enableSynonymExpansion').checked,
                        use_hybrid: document.getElementById('useHybrid').checked,
                        keyword_weight: parseFloat(document.getElementById('keywordWeight').value)
                    })
                });

                if (!response.ok) {
                    throw new Error(`æœç´¢å¤±è´¥: ${response.status}`);
                }

                const data = await response.json();
                const searchTime = Date.now() - searchStartTime;

                displayResults(data.results, data.query_info, data.message);
                updateDebugInfo(data.query_info, searchTime, data.total_count);

            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">æœç´¢å¤±è´¥: ${error.message}</div>`;
                queryInfoDiv.className = 'query-info';
            }
        }

        function displayResults(results, queryInfo, message) {
            const resultsDiv = document.getElementById('results');
            const queryInfoDiv = document.getElementById('queryInfo');

            // æ˜¾ç¤ºæŸ¥è¯¢ä¿¡æ¯
            if (message || queryInfo.corrections?.length > 0 || queryInfo.expansions?.length > 0) {
                let infoHtml = '';
                let infoClass = 'query-info show';

                if (queryInfo.corrections?.length > 0) {
                    infoHtml = `<strong>æ‹¼å†™çº é”™:</strong> ${message}`;
                    infoClass += ' correction-info';
                } else if (queryInfo.expansions?.length > 0) {
                    infoHtml = `<strong>åŒä¹‰è¯æ‰©å±•:</strong> ${message}<br>æ‰©å±•è¯æ±‡: ${queryInfo.expansions.join(', ')}`;
                    infoClass += ' expansion-info';
                } else if (message && message.includes('æ··åˆæ£€ç´¢')) {
                    infoHtml = `<strong>æ··åˆæ£€ç´¢:</strong> ${message}`;
                    infoClass += ' hybrid-info';
                } else if (message) {
                    infoHtml = message;
                }

                queryInfoDiv.innerHTML = infoHtml;
                queryInfoDiv.className = infoClass;
            } else {
                queryInfoDiv.className = 'query-info';
            }

            if (!results || results.length === 0) {
                resultsDiv.innerHTML = `<div class="error">æœªæ‰¾åˆ°å…³äº "${queryInfo.original_query}" çš„ç»“æœ</div>`;
                return;
            }

            let html = `<h2>æ‰¾åˆ° ${results.length} ä¸ªå…³äº "${queryInfo.original_query}" çš„ç»“æœ</h2>`;

            results.forEach(result => {
                const scorePercentage = (result.score * 100).toFixed(1);
                const searchTypeBadge = result.search_type === 'hybrid' ?
                    '<span class="search-type-badge hybrid-badge">æ··åˆæ£€ç´¢</span>' :
                    '<span class="search-type-badge keyword-badge">å…³é”®è¯</span>';

                html += `
                    <div class="result-item">
                        <div class="result-title">${result.title}</div>
                        <div class="result-meta">
                            <span>åˆ†ç±»: ${result.main_category}</span>
                            ${result.price ? `<span>ä»·æ ¼: $${result.price.toFixed(2)}</span>` : ''}
                            ${result.average_rating ? `<span>è¯„åˆ†: ${result.average_rating.toFixed(1)}/5.0</span>` : ''}
                            <span class="score-badge">ç›¸å…³åº¦: ${scorePercentage}%</span>
                            ${searchTypeBadge}
                        </div>
                        ${result.description ? `<div class="result-description">${result.description.substring(0, 200)}...</div>` : ''}
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }

        function updateDebugInfo(queryInfo, searchTime, totalCount) {
            document.getElementById('searchTime').textContent = searchTime;
            document.getElementById('searchStrategy').textContent = queryInfo.search_strategy || 'exact';

            const capabilities = Object.values(searchCapabilities).filter(Boolean).length;
            document.getElementById('searchCapabilities').textContent = capabilities;

            // åœ¨è°ƒè¯•è¾“å‡ºä¸­æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
            const debugOutput = document.getElementById('debugOutput');
            debugOutput.innerHTML = `
                <strong>æŸ¥è¯¢ä¿¡æ¯:</strong><br>
                åŸå§‹æŸ¥è¯¢: ${queryInfo.original_query}<br>
                å¤„ç†åæŸ¥è¯¢: ${queryInfo.processed_query}<br>
                æœç´¢ç­–ç•¥: ${queryInfo.search_strategy}<br>
                ${queryInfo.keyword_weight ? `å…³é”®è¯æƒé‡: ${queryInfo.keyword_weight}<br>` : ''}
                ${queryInfo.semantic_weight ? `è¯­ä¹‰æƒé‡: ${queryInfo.semantic_weight}<br>` : ''}
                ${queryInfo.corrections?.length > 0 ? `æ‹¼å†™çº é”™: ${queryInfo.corrections.join(', ')}<br>` : ''}
                ${queryInfo.expansions?.length > 0 ? `åŒä¹‰è¯æ‰©å±•: ${queryInfo.expansions.join(', ')}<br>` : ''}
                ç»“æœæ•°é‡: ${totalCount}
            `;
        }

        async function compareSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }

            const comparisonSection = document.getElementById('comparisonSection');
            comparisonSection.classList.toggle('show');

            if (!comparisonSection.classList.contains('show')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/compare-search?query=${encodeURIComponent(query)}&top_k=5`, {
                    method: 'POST'
                });

                if (!response.ok) {
                    throw new Error(`å¯¹æ¯”å¤±è´¥: ${response.status}`);
                }

                const data = await response.json();

                // æ˜¾ç¤ºå…³é”®è¯æœç´¢ç»“æœ
                document.getElementById('keywordTab').innerHTML = formatComparisonResults(data.comparison.keyword_only.results, 'å…³é”®è¯æœç´¢');

                // æ˜¾ç¤ºæ··åˆæ£€ç´¢ç»“æœ
                if (data.comparison.hybrid) {
                    document.getElementById('hybridTabContent').innerHTML = formatComparisonResults(data.comparison.hybrid.results, 'æ··åˆæ£€ç´¢');
                    document.getElementById('hybridTab').style.display = 'block';
                } else {
                    document.getElementById('hybridTab').style.display = 'none';
                }

                // æ˜¾ç¤ºå¢å¼ºæœç´¢ç»“æœ
                document.getElementById('enhancedTab').innerHTML = formatComparisonResults(data.comparison.enhanced.results, 'å¢å¼ºæœç´¢');

            } catch (error) {
                comparisonSection.innerHTML = `<div class="error">å¯¹æ¯”å¤±è´¥: ${error.message}</div>`;
            }
        }

        function formatComparisonResults(results, title) {
            if (!results || results.length === 0) {
                return `<p>æ²¡æœ‰æ‰¾åˆ°ç»“æœ</p>`;
            }

            let html = `<h4>${title} - ${results.length} ä¸ªç»“æœ</h4>`;
            results.forEach((result, index) => {
                const scorePercentage = (result.score * 100).toFixed(1);
                html += `
                    <div style="padding: 10px; margin: 5px 0; background: #f8fafc; border-radius: 8px; border-left: 4px solid #3498db;">
                        <div style="font-weight: 600; margin-bottom: 5px;">${index + 1}. ${result.title.substring(0, 60)}...</div>
                        <div style="font-size: 12px; color: #7f8c8d;">
                            åˆ†ç±»: ${result.main_category} | ç›¸å…³åº¦: ${scorePercentage}%
                            ${result.search_type ? ` | ç±»å‹: ${result.search_type}` : ''}
                        </div>
                    </div>
                `;
            });
            return html;
        }

        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾
            document.getElementById(tabName + (tabName === 'hybrid' ? 'TabContent' : 'Tab')).classList.add('active');
            event.target.classList.add('active');
        }

        function toggleDebug() {
            const debugSection = document.getElementById('debugSection');
            debugSection.classList.toggle('show');
        }

        async function testSpellCheck() {
            const testQueries = ['phoen', 'laptap', 'boook', 'cmputer', 'smartphon'];
            const debugOutput = document.getElementById('debugOutput');

            let output = '<strong>æ‹¼å†™æ£€æŸ¥æµ‹è¯•:</strong><br>';

            for (const query of testQueries) {
                try {
                    const response = await fetch(`${API_BASE}/api/spell-check?query=${encodeURIComponent(query)}`, {
                        method: 'POST'
                    });
                    const data = await response.json();
                    output += `${query} â†’ ${data.corrected} ${data.has_corrections ? '(å·²çº æ­£)' : '(æ— éœ€çº æ­£)'}<br>`;
                } catch (error) {
                    output += `${query} â†’ æ£€æŸ¥å¤±è´¥<br>`;
                }
            }

            debugOutput.innerHTML = output;
        }

        async function showSynonyms() {
            const debugOutput = document.getElementById('debugOutput');

            try {
                const response = await fetch(`${API_BASE}/api/synonyms`);
                const data = await response.json();

                let output = '<strong>åŒä¹‰è¯è¯å…¸:</strong><br>';
                Object.entries(data.synonyms).slice(0, 10).forEach(([word, synonyms]) => {
                    output += `${word}: ${synonyms.join(', ')}<br>`;
                });
                output += `... å…± ${data.total_words} ä¸ªè¯æ±‡`;

                debugOutput.innerHTML = output;
            } catch (error) {
                debugOutput.innerHTML = 'è·å–åŒä¹‰è¯å¤±è´¥';
            }
        }

        async function getCapabilities() {
            const debugOutput = document.getElementById('debugOutput');

            try {
                const response = await fetch(`${API_BASE}/api/capabilities`);
                const data = await response.json();

                let output = '<strong>æœç´¢èƒ½åŠ›:</strong><br>';
                Object.entries(data).forEach(([capability, available]) => {
                    const status = available ? 'âœ…' : 'âŒ';
                    output += `${status} ${capability}: ${available ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}<br>`;
                });

                debugOutput.innerHTML = output;
                searchCapabilities = data;

                // æ›´æ–°åŠŸèƒ½æ ‡ç­¾çŠ¶æ€
                updateFeatureTags(data);

            } catch (error) {
                debugOutput.innerHTML = 'è·å–èƒ½åŠ›ä¿¡æ¯å¤±è´¥';
            }
        }

        function updateFeatureTags(capabilities) {
            const semanticFeature = document.getElementById('semanticFeature');
            if (!capabilities.semantic_search) {
                semanticFeature.classList.add('disabled');
                semanticFeature.textContent = 'ğŸ§  è¯­ä¹‰æœç´¢ (ä¸å¯ç”¨)';
            } else {
                semanticFeature.classList.remove('disabled');
                semanticFeature.textContent = 'ğŸ§  è¯­ä¹‰æœç´¢';
            }
        }

        // å›è½¦é”®æœç´¢
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                search();
            }
        });

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥APIçŠ¶æ€
        window.onload = async function() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const health = await response.json();

                document.getElementById('totalProducts').textContent = health.total_products || 0;

                if (health.search_capabilities) {
                    searchCapabilities = health.search_capabilities;
                    updateFeatureTags(health.search_capabilities);
                }

                if (!health.engine_ready) {
                    document.getElementById('results').innerHTML =
                        '<div class="loading">ç³»ç»Ÿæ­£åœ¨åˆå§‹åŒ–ï¼Œè¯·ç¨å€™...</div>';
                } else {
                    document.getElementById('results').innerHTML =
                        '<div style="text-align: center; padding: 50px; color: #7f8c8d;">è¯·è¾“å…¥æœç´¢å…³é”®è¯å¼€å§‹æ··åˆæ£€ç´¢</div>';
                }
            } catch (error) {
                document.getElementById('results').innerHTML =
                    '<div class="error">æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·ç¡®ä¿APIæœåŠ¡æ­£åœ¨è¿è¡Œ</div>';
            }
        };

        // æ·»åŠ ä¸€äº›ç¤ºä¾‹æŸ¥è¯¢çš„å¿«æ·æŒ‰é’®
        function addExampleQueries() {
            const examples = [
                { text: 'phone', desc: 'æ‰‹æœº (æµ‹è¯•è¯­ä¹‰æœç´¢)' },
                { text: 'laptap', desc: 'ç¬”è®°æœ¬ (æµ‹è¯•æ‹¼å†™çº é”™)' },
                { text: 'cheap book', desc: 'ä¾¿å®œçš„ä¹¦ (æµ‹è¯•åŒä¹‰è¯æ‰©å±•)' },
                { text: 'smartphone camera', desc: 'æ™ºèƒ½æ‰‹æœºæ‘„åƒå¤´ (æµ‹è¯•æ··åˆæ£€ç´¢)' }
            ];

            let exampleHtml = '<div style="margin-top: 15px;"><strong>ç¤ºä¾‹æŸ¥è¯¢:</strong> ';
            examples.forEach(example => {
                exampleHtml += `<button onclick="document.getElementById('searchInput').value='${example.text}'; search();"
                    style="margin: 5px; padding: 5px 10px; background: #e9ecef; border: none; border-radius: 15px; cursor: pointer; font-size: 12px; transition: background 0.2s ease;"
                    onmouseover="this.style.background='#dee2e6'"
                    onmouseout="this.style.background='#e9ecef'"
                    title="${example.desc}">${example.text}</button>`;
            });
            exampleHtml += '</div>';

            document.querySelector('.search-section').insertAdjacentHTML('beforeend', exampleHtml);
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ·»åŠ ç¤ºä¾‹æŸ¥è¯¢
        document.addEventListener('DOMContentLoaded', addExampleQueries);
    </script>
</body>
</html>