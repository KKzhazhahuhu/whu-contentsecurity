<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Áè≠Á∫ßËÄÉÂã§Á≥ªÁªü</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.15.13/theme-chalk/index.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <el-container class="main-container">
            <el-header class="header">
                <div class="header-content">
                    <h1 class="title">
                        <i class="el-icon-user-solid"></i>
                        Áè≠Á∫ßËÄÉÂã§Á≥ªÁªü
                    </h1>
                    <div class="header-info">
                        <el-tag :type="systemStatus.baidu_api_available ? 'success' : 'warning'" size="small">
                            ÁôæÂ∫¶API: {{ systemStatus.baidu_api_available ? 'ÂèØÁî®' : '‰∏çÂèØÁî®' }}
                        </el-tag>
                        <el-tag :type="systemStatus.dlib_available ? 'success' : 'warning'" size="small" style="margin-left: 5px;">
                            dlib: {{ systemStatus.dlib_available ? 'ÂèØÁî®' : '‰∏çÂèØÁî®' }}
                        </el-tag>
                        <el-tag type="info" size="small" style="margin-left: 5px;">
                            ‰∫∫ËÑ∏Â∫ì: {{ systemStatus.face_database_count }}‰∫∫
                        </el-tag>
                        <el-button type="text" @click="loadSystemStatus" style="margin-left: 10px;">
                            <i class="el-icon-refresh"></i>
                        </el-button>
                    </div>
                </div>
            </el-header>

            <el-main class="main-content">
                <!-- ÈÄâÈ°πÂç°ÂàáÊç¢ -->
                <el-tabs v-model="activeTab" @tab-click="handleTabClick" class="main-tabs">
                    <!-- ËÄÉÂã§ÊâìÂç° -->
                    <el-tab-pane label="ËÄÉÂã§ÊâìÂç°" name="attendance">
                        <!-- ÈáçË¶ÅÊèêÁ§∫ -->
                        <div class="important-notice">
                            <el-alert
                                title="üí° ÈáçË¶ÅÊèêÁ§∫"
                                description="ÂèØ‰ª•Âú®Âè≥‰æßÈÄâÊã©‰∏çÂêåÁöÑÊ¥ª‰ΩìÊ£ÄÊµãÊñπÊ≥ïÔºåÊàñ‰ΩøÁî®ÊëÑÂÉèÂ§¥‰∏ãÊñπÁöÑÂø´ÈÄüÂàáÊç¢ÊåâÈíÆ"
                                type="info"
                                show-icon
                                :closable="false"
                                style="margin-bottom: 20px;"
                            >
                            </el-alert>
                        </div>

                        <div class="attendance-container">
                            <!-- Â∑¶‰æßÔºöÊëÑÂÉèÂ§¥Âå∫Âüü -->
                            <div class="camera-section">
                                <el-card class="camera-card">
                                    <div slot="header">
                                        <span>ÊëÑÂÉèÂ§¥ÁõëÊéß</span>
                                        <el-tag :type="cameraActive ? 'success' : 'info'" size="mini" style="float: right;">
                                            {{ cameraActive ? 'ËøêË°å‰∏≠' : 'Êú™ÂêØÂä®' }}
                                        </el-tag>
                                    </div>

                                    <div class="camera-container">
                                        <video
                                            ref="video"
                                            :width="cameraConfig.width"
                                            :height="cameraConfig.height"
                                            autoplay
                                            muted
                                            class="video-element"
                                            :class="{ 'camera-inactive': !cameraActive }"
                                        ></video>
                                        <canvas
                                            ref="canvas"
                                            :width="cameraConfig.width"
                                            :height="cameraConfig.height"
                                            style="display: none;"
                                        ></canvas>

                                        <!-- ÊëÑÂÉèÂ§¥Êú™ÂêØÂä®Êó∂ÁöÑÂç†‰ΩçÁ¨¶ -->
                                        <div v-if="!cameraActive" class="camera-placeholder">
                                            <i class="el-icon-video-camera camera-placeholder-icon"></i>
                                            <p>ÊëÑÂÉèÂ§¥Êú™ÂêØÂä®</p>
                                        </div>
                                    </div>

                                    <!-- ÊéßÂà∂ÊåâÈíÆ -->
                                    <div class="camera-controls">
                                        <div class="control-row">
                                            <el-button
                                                type="primary"
                                                icon="el-icon-video-camera-solid"
                                                @click="startCamera"
                                                :disabled="cameraActive"
                                                size="small"
                                            >
                                                ÂêØÂä®ÊëÑÂÉèÂ§¥
                                            </el-button>

                                            <el-button
                                                type="success"
                                                icon="el-icon-check"
                                                @click="captureAndAttendance"
                                                :disabled="!cameraActive || processing"
                                                :loading="processing"
                                                size="small"
                                            >
                                                ËÄÉÂã§ÊâìÂç°
                                            </el-button>

                                            <el-button
                                                type="info"
                                                icon="el-icon-refresh"
                                                @click="stopCamera"
                                                :disabled="!cameraActive"
                                                size="small"
                                            >
                                                ÂÅúÊ≠¢ÊëÑÂÉèÂ§¥
                                            </el-button>
                                        </div>

                                        <!-- Âø´ÈÄüÂàáÊç¢Ê£ÄÊµãÊñπÊ≥ï -->
                                        <div class="quick-method-switch">
                                            <span class="switch-label">Âø´ÈÄüÂàáÊç¢:</span>
                                            <el-button-group>
                                                <el-button
                                                    v-for="method in livenessMethods"
                                                    :key="method.key"
                                                    :type="selectedLivenessMethod === method.key ? 'primary' : 'default'"
                                                    size="mini"
                                                    @click="quickSwitchMethod(method.key)"
                                                >
                                                    {{ method.name }}
                                                </el-button>
                                            </el-button-group>
                                        </div>
                                    </div>
                                </el-card>


                            </div>

                            <!-- Âè≥‰æßÔºöÁªìÊûúÊòæÁ§∫Âå∫Âüü -->
                            <div class="result-section">
                                <!-- Ê¥ª‰ΩìÊ£ÄÊµãÊñπÊ≥ïÈÄâÊã© - ÁßªÂà∞Âè≥‰æßÈ°∂ÈÉ®Êõ¥ÊòæÁúº -->
                                <el-card class="method-selection-card">
                                    <div slot="header">
                                        <span><i class="el-icon-set-up"></i> Ê¥ª‰ΩìÊ£ÄÊµãÊñπÊ≥ïÈÄâÊã©</span>
                                        <el-tag type="warning" size="mini" style="float: right;">
                                            ÈáçË¶ÅËÆæÁΩÆ
                                        </el-tag>
                                    </div>
                                    <div class="method-selection-content">
                                        <el-radio-group
                                            v-model="selectedLivenessMethod"
                                            @change="onLivenessMethodChange"
                                            class="method-radio-group"
                                        >
                                            <el-radio
                                                v-for="method in livenessMethods"
                                                :key="method.key"
                                                :label="method.key"
                                                class="method-radio-item"
                                            >
                                                <div class="method-option">
                                                    <div class="method-name">{{ method.name }}</div>
                                                    <div class="method-desc">{{ method.description }}</div>
                                                </div>
                                            </el-radio>
                                        </el-radio-group>

                                        <div class="current-method-info">
                                            <el-alert
                                                :title="`ÂΩìÂâçÊñπÊ≥ï: ${getCurrentMethodInfo().name}`"
                                                :description="getCurrentMethodInfo().description"
                                                type="success"
                                                :closable="false"
                                                show-icon
                                            ></el-alert>
                                        </div>

                                        <!-- ÊñπÊ≥ïÂØπÊØîËØ¥Êòé -->
                                        <div class="method-comparison">
                                            <el-collapse accordion>
                                                <el-collapse-item title="üìä ÊñπÊ≥ïÂØπÊØîËØ¥Êòé" name="comparison">
                                                    <el-table :data="methodComparisonData" size="mini" border>
                                                        <el-table-column prop="method" label="Ê£ÄÊµãÊñπÊ≥ï" width="120"></el-table-column>
                                                        <el-table-column prop="accuracy" label="ÂáÜÁ°ÆÂ∫¶" width="80"></el-table-column>
                                                        <el-table-column prop="speed" label="Ê£ÄÊµãÈÄüÂ∫¶" width="80"></el-table-column>
                                                        <el-table-column prop="network" label="ÁΩëÁªú‰æùËµñ" width="80"></el-table-column>
                                                        <el-table-column prop="features" label="‰∏ªË¶ÅÁâπÁÇπ"></el-table-column>
                                                    </el-table>
                                                </el-collapse-item>
                                            </el-collapse>
                                        </div>
                                    </div>
                                </el-card>

                                <!-- Á≥ªÁªüÁä∂ÊÄÅ -->
                                <el-card class="status-card">
                                    <div slot="header">
                                        <span>Á≥ªÁªüÁä∂ÊÄÅ</span>
                                        <el-button type="text" @click="loadSystemStatus" style="float: right;">
                                            <i class="el-icon-refresh"></i>
                                        </el-button>
                                    </div>
                                    <div class="status-content">
                                        <div class="status-item">
                                            <span class="status-label">ÊëÑÂÉèÂ§¥Áä∂ÊÄÅ:</span>
                                            <el-tag :type="cameraActive ? 'success' : 'info'" size="mini">
                                                {{ cameraActive ? 'ËøêË°å‰∏≠' : 'Êú™ÂêØÂä®' }}
                                            </el-tag>
                                        </div>
                                        <div class="status-item">
                                            <span class="status-label">Ê£ÄÊµãÊñπÊ≥ï:</span>
                                            <span class="status-value">{{ getCurrentMethodInfo().name }}</span>
                                        </div>
                                        <div class="status-item">
                                            <span class="status-label">Ê£ÄÊµãÈòàÂÄº:</span>
                                            <span class="status-value">{{ systemStatus.liveness_threshold || 0.7 }}</span>
                                        </div>
                                        <div class="status-item">
                                            <span class="status-label">ÊúÄÂêéÊõ¥Êñ∞:</span>
                                            <span class="status-value">{{ formatTime(new Date()) }}</span>
                                        </div>
                                    </div>
                                </el-card>

                                <!-- Ê£ÄÊµãÁªìÊûú -->
                                <el-card class="result-card" v-if="lastAttendanceResult">
                                    <div slot="header">
                                        <span>ÊúÄÊñ∞Ê£ÄÊµãÁªìÊûú</span>
                                        <el-button type="text" @click="clearLastResult" style="float: right;">
                                            <i class="el-icon-close"></i>
                                        </el-button>
                                    </div>
                                    <div v-if="lastAttendanceResult.success" class="success-result">
                                        <el-alert
                                            title="ËÄÉÂã§ÊàêÂäü"
                                            type="success"
                                            :description="`${lastAttendanceResult.attendance_results[0].student_name} (${lastAttendanceResult.attendance_results[0].student_id}) ÊâìÂç°ÊàêÂäü`"
                                            show-icon
                                            :closable="false"
                                        ></el-alert>
                                        <div class="result-details">
                                            <div class="detail-item">
                                                <span class="detail-label">ËØÜÂà´ÁΩÆ‰ø°Â∫¶:</span>
                                                <el-progress
                                                    :percentage="Math.round(lastAttendanceResult.attendance_results[0].confidence * 100)"
                                                    :color="getProgressColor(lastAttendanceResult.attendance_results[0].confidence * 100)"
                                                ></el-progress>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">Ê¥ª‰ΩìÊ£ÄÊµãÂàÜÊï∞:</span>
                                                <el-progress
                                                    :percentage="Math.round(lastAttendanceResult.liveness_score * 100)"
                                                    :color="getProgressColor(lastAttendanceResult.liveness_score * 100)"
                                                ></el-progress>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">Ê£ÄÊµãÊñπÊ≥ï:</span>
                                                <span class="detail-value">{{ lastAttendanceResult.liveness_method_name }}</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">Ê£ÄÊµãÊó∂Èó¥:</span>
                                                <span class="detail-value">{{ formatTime(lastAttendanceResult.timestamp) }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-else class="error-result">
                                        <el-alert
                                            title="ËÄÉÂã§Â§±Ë¥•"
                                            type="error"
                                            :description="lastAttendanceResult.error || 'Êú™Áü•ÈîôËØØ'"
                                            show-icon
                                            :closable="false"
                                        ></el-alert>
                                        <div v-if="lastAttendanceResult.liveness_score" class="result-details">
                                            <div class="detail-item">
                                                <span class="detail-label">Ê¥ª‰ΩìÊ£ÄÊµãÂàÜÊï∞:</span>
                                                <el-progress
                                                    :percentage="Math.round(lastAttendanceResult.liveness_score * 100)"
                                                    status="exception"
                                                ></el-progress>
                                            </div>
                                        </div>
                                    </div>
                                </el-card>

                                <!-- ‰ªäÊó•ËÄÉÂã§ÁªüËÆ° -->
                                <el-card class="summary-card">
                                    <div slot="header">
                                        <span>‰ªäÊó•ËÄÉÂã§ÁªüËÆ°</span>
                                        <el-button type="text" @click="loadAttendanceSummary" style="float: right;">
                                            <i class="el-icon-refresh"></i>
                                        </el-button>
                                    </div>
                                    <div class="summary-content">
                                        <div class="summary-item">
                                            <div class="summary-number">{{ attendanceSummary.total_students }}</div>
                                            <div class="summary-label">Âá∫Âã§‰∫∫Êï∞</div>
                                        </div>
                                        <div class="summary-item">
                                            <div class="summary-number">{{ attendanceSummary.total_records }}</div>
                                            <div class="summary-label">ÊâìÂç°Ê¨°Êï∞</div>
                                        </div>
                                        <div class="summary-item">
                                            <div class="summary-number">{{ Math.round((attendanceSummary.avg_confidence || 0) * 100) }}%</div>
                                            <div class="summary-label">Âπ≥ÂùáÁΩÆ‰ø°Â∫¶</div>
                                        </div>
                                        <div class="summary-item">
                                            <div class="summary-number">{{ Math.round((attendanceSummary.avg_liveness_score || 0) * 100) }}%</div>
                                            <div class="summary-label">Âπ≥ÂùáÊ¥ª‰ΩìÂàÜÊï∞</div>
                                        </div>
                                    </div>
                                </el-card>
                            </div>
                        </div>
                    </el-tab-pane>

                    <!-- Â≠¶ÁîüÁÆ°ÁêÜ -->
                    <el-tab-pane label="Â≠¶ÁîüÁÆ°ÁêÜ" name="students">
                        <div class="students-container">
                            <!-- Ê∑ªÂä†Â≠¶ÁîüË°®Âçï -->
                            <el-card class="add-student-card">
                                <div slot="header">
                                    <span>Ê∑ªÂä†Êñ∞Â≠¶Áîü</span>
                                    <el-button type="text" @click="resetStudentForm" style="float: right;">
                                        <i class="el-icon-refresh"></i> ÈáçÁΩÆË°®Âçï
                                    </el-button>
                                </div>

                                <el-form ref="studentForm" :model="newStudent" :rules="studentRules" label-width="100px">
                                    <el-row :gutter="20">
                                        <el-col :span="8">
                                            <el-form-item label="Â≠¶Âè∑" prop="student_id">
                                                <el-input
                                                    v-model="newStudent.student_id"
                                                    placeholder="ËØ∑ËæìÂÖ•Â≠¶Âè∑"
                                                    :disabled="addingStudent"
                                                ></el-input>
                                            </el-form-item>
                                        </el-col>
                                        <el-col :span="8">
                                            <el-form-item label="ÂßìÂêç" prop="name">
                                                <el-input
                                                    v-model="newStudent.name"
                                                    placeholder="ËØ∑ËæìÂÖ•ÂßìÂêç"
                                                    :disabled="addingStudent"
                                                ></el-input>
                                            </el-form-item>
                                        </el-col>
                                        <el-col :span="8">
                                            <el-form-item label="Áè≠Á∫ß" prop="class_name">
                                                <el-input
                                                    v-model="newStudent.class_name"
                                                    placeholder="ËØ∑ËæìÂÖ•Áè≠Á∫ß"
                                                    :disabled="addingStudent"
                                                ></el-input>
                                            </el-form-item>
                                        </el-col>
                                    </el-row>

                                    <el-form-item label="‰∫∫ËÑ∏ÁÖßÁâá" prop="image">
                                        <div class="photo-capture-section">
                                            <!-- ÊëÑÂÉèÂ§¥È¢ÑËßàÂå∫Âüü -->
                                            <div class="camera-preview-container">
                                                <div class="camera-preview">
                                                    <video
                                                        ref="studentVideo"
                                                        :width="320"
                                                        :height="240"
                                                        autoplay
                                                        muted
                                                        class="student-video-element"
                                                        :class="{ 'camera-inactive': !studentCameraActive }"
                                                    ></video>
                                                    <canvas
                                                        ref="studentCanvas"
                                                        :width="320"
                                                        :height="240"
                                                        style="display: none;"
                                                    ></canvas>

                                                    <!-- ÊëÑÂÉèÂ§¥Êú™ÂêØÂä®Êó∂ÁöÑÂç†‰ΩçÁ¨¶ -->
                                                    <div v-if="!studentCameraActive" class="student-camera-placeholder">
                                                        <i class="el-icon-video-camera camera-placeholder-icon"></i>
                                                        <p>ÁÇπÂáªÂêØÂä®ÊëÑÂÉèÂ§¥</p>
                                                    </div>
                                                </div>

                                                <!-- ÊãçÊëÑÁªìÊûúÈ¢ÑËßà -->
                                                <div v-if="capturedPhotoPreview" class="photo-preview">
                                                    <img :src="capturedPhotoPreview" alt="ÊãçÊëÑÁöÑÁÖßÁâá" class="preview-image" />
                                                    <div class="preview-overlay">
                                                        <el-button type="success" size="mini" @click="confirmPhoto">
                                                            <i class="el-icon-check"></i> Á°ÆËÆ§‰ΩøÁî®
                                                        </el-button>
                                                        <el-button type="warning" size="mini" @click="retakePhoto">
                                                            <i class="el-icon-refresh"></i> ÈáçÊñ∞ÊãçÊëÑ
                                                        </el-button>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- ÊëÑÂÉèÂ§¥ÊéßÂà∂ÊåâÈíÆ -->
                                            <div class="photo-controls">
                                                <el-button
                                                    type="primary"
                                                    @click="toggleStudentCamera"
                                                    :disabled="addingStudent"
                                                    size="small"
                                                >
                                                    <i :class="studentCameraActive ? 'el-icon-video-pause' : 'el-icon-video-play'"></i>
                                                    {{ studentCameraActive ? 'ÂÖ≥Èó≠ÊëÑÂÉèÂ§¥' : 'ÂêØÂä®ÊëÑÂÉèÂ§¥' }}
                                                </el-button>

                                                <el-button
                                                    type="success"
                                                    @click="captureStudentPhoto"
                                                    :disabled="!studentCameraActive || addingStudent || !!capturedPhotoPreview"
                                                    size="small"
                                                >
                                                    <i class="el-icon-camera"></i> ÊãçÊëÑÁÖßÁâá
                                                </el-button>
                                            </div>

                                            <!-- Áä∂ÊÄÅÊòæÁ§∫ -->
                                            <div class="photo-status-info">
                                                <el-tag v-if="newStudent.image" type="success" size="mini">
                                                    <i class="el-icon-check"></i> ÁÖßÁâáÂ∑≤Â∞±Áª™
                                                </el-tag>
                                                <el-tag v-else type="warning" size="mini">
                                                    <i class="el-icon-warning"></i> ËØ∑ÊãçÊëÑ‰∫∫ËÑ∏ÁÖßÁâá
                                                </el-tag>
                                            </div>
                                        </div>
                                    </el-form-item>

                                    <el-form-item>
                                        <el-button
                                            type="primary"
                                            @click="addStudent"
                                            :loading="addingStudent"
                                            :disabled="!newStudent.image"
                                        >
                                            <i class="el-icon-plus"></i> Ê∑ªÂä†Â≠¶Áîü
                                        </el-button>
                                        <el-button @click="resetStudentForm" :disabled="addingStudent">
                                            <i class="el-icon-refresh"></i> ÈáçÁΩÆ
                                        </el-button>
                                        <el-button type="info" @click="testAddStudent" size="mini" style="margin-left: 10px;">
                                            <i class="el-icon-view"></i> Ë∞ÉËØï‰ø°ÊÅØ
                                        </el-button>
                                    </el-form-item>
                                </el-form>
                            </el-card>

                            <!-- Â≠¶ÁîüÂàóË°® -->
                            <el-card class="students-list-card">
                                <div slot="header">
                                    <span>Â≠¶ÁîüÂàóË°® ({{ students.length }}‰∫∫)</span>
                                    <div style="float: right;">
                                        <el-input
                                            placeholder="ÊêúÁ¥¢Â≠¶Âè∑„ÄÅÂßìÂêçÊàñÁè≠Á∫ß"
                                            v-model="studentSearchKeyword"
                                            size="mini"
                                            style="width: 200px; margin-right: 10px;"
                                            prefix-icon="el-icon-search"
                                            clearable
                                            @clear="clearSearch"
                                        ></el-input>
                                        <el-button type="text" @click="clearSearch" v-if="studentSearchKeyword">
                                            <i class="el-icon-close"></i> Ê∏ÖÈô§ÊêúÁ¥¢
                                        </el-button>
                                        <el-button type="text" @click="loadStudents">
                                            <i class="el-icon-refresh"></i> Âà∑Êñ∞
                                        </el-button>
                                        <el-button type="text" @click="debugStudentData" size="mini">
                                            <i class="el-icon-view"></i> Ë∞ÉËØï
                                        </el-button>
                                    </div>
                                </div>

                                <el-table
                                    :data="filteredStudents"
                                    stripe
                                    style="width: 100%"
                                    v-loading="loadingStudents"
                                    empty-text="ÊöÇÊó†Â≠¶ÁîüÊï∞ÊçÆ"
                                >
                                    <el-table-column prop="student_id" label="Â≠¶Âè∑" width="120" sortable></el-table-column>
                                    <el-table-column prop="name" label="ÂßìÂêç" width="120" sortable></el-table-column>
                                    <el-table-column prop="class_name" label="Áè≠Á∫ß" width="150" sortable></el-table-column>
                                    <el-table-column label="‰∫∫ËÑ∏Áä∂ÊÄÅ" width="120">
                                        <template slot-scope="scope">
                                            <el-tag :type="scope.row.has_face_encoding ? 'success' : 'warning'" size="mini">
                                                {{ scope.row.has_face_encoding ? 'Â∑≤ÂΩïÂÖ•' : 'Êú™ÂΩïÂÖ•' }}
                                            </el-tag>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="Ë¥®ÈáèÂàÜÊï∞" width="120">
                                        <template slot-scope="scope">
                                            <span v-if="scope.row.face_quality_score && scope.row.face_quality_score > 0">
                                                {{ (scope.row.face_quality_score * 100).toFixed(1) }}%
                                            </span>
                                            <span v-else>-</span>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="created_at" label="Ê≥®ÂÜåÊó∂Èó¥" :formatter="formatTableTime" sortable></el-table-column>
                                    <el-table-column label="Êìç‰Ωú" width="150" fixed="right">
                                        <template slot-scope="scope">
                                            <el-button
                                                size="mini"
                                                type="primary"
                                                @click="viewStudent(scope.row)"
                                                icon="el-icon-view"
                                            >
                                                Êü•Áúã
                                            </el-button>
                                            <el-button
                                                size="mini"
                                                type="danger"
                                                @click="deleteStudent(scope.row)"
                                                icon="el-icon-delete"
                                            >
                                                Âà†Èô§
                                            </el-button>
                                        </template>
                                    </el-table-column>
                                </el-table>

                                <!-- Ë∞ÉËØï‰ø°ÊÅØÊòæÁ§∫ -->
                                <div style="margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 4px; font-size: 12px; color: #666;">
                                    <strong>ÂÆûÊó∂Ë∞ÉËØï‰ø°ÊÅØ:</strong><br>
                                    - ÂéüÂßãÂ≠¶ÁîüÊï∞Èáè: {{ students.length }}<br>
                                    - ËøáÊª§ÂêéÊï∞Èáè: {{ filteredStudents.length }}<br>
                                    - ÊêúÁ¥¢ÂÖ≥ÈîÆËØç: "{{ studentSearchKeyword }}" ({{ studentSearchKeyword ? 'ÊúâÂÜÖÂÆπ' : 'Á©∫' }})<br>
                                    - ÊêúÁ¥¢ÂÖ≥ÈîÆËØçÈïøÂ∫¶: {{ studentSearchKeyword ? studentSearchKeyword.length : 0 }}<br>
                                    - studentsÊï∞ÁªÑÁ±ªÂûã: {{ Array.isArray(students) ? 'Êï∞ÁªÑ' : 'ÈùûÊï∞ÁªÑ' }}<br>
                                    - filteredStudentsÊï∞ÁªÑÁ±ªÂûã: {{ Array.isArray(filteredStudents) ? 'Êï∞ÁªÑ' : 'ÈùûÊï∞ÁªÑ' }}<br>
                                    <span v-if="students.length > 0">
                                        - Á¨¨‰∏Ä‰∏™Â≠¶Áîü: {{ students[0].name }} ({{ students[0].student_id }})<br>
                                        - Á¨¨‰∏Ä‰∏™Â≠¶ÁîüÂÆåÊï¥Êï∞ÊçÆ: {{ JSON.stringify(students[0]) }}
                                    </span>
                                    <br>
                                    <strong style="color: red;">Ê≥®ÊÑè: ÊêúÁ¥¢ÂäüËÉΩÂ∑≤ÊöÇÊó∂Á¶ÅÁî®ÔºåÂ∫îÊòæÁ§∫ÂÖ®ÈÉ®Â≠¶Áîü</strong>
                                </div>
                            </el-card>
                        </div>
                    </el-tab-pane>

                    <!-- ËÄÉÂã§ËÆ∞ÂΩï -->
                    <el-tab-pane label="ËÄÉÂã§ËÆ∞ÂΩï" name="records">
                        <div class="records-container">
                            <el-card>
                                <div slot="header">
                                    <span>ËÄÉÂã§ËÆ∞ÂΩï</span>
                                    <div style="float: right;">
                                        <el-date-picker
                                            v-model="selectedDate"
                                            type="date"
                                            placeholder="ÈÄâÊã©Êó•Êúü"
                                            @change="loadAttendanceRecords"
                                            format="yyyy-MM-dd"
                                            value-format="yyyy-MM-dd"
                                            size="mini"
                                            style="margin-right: 10px;"
                                        >
                                        </el-date-picker>
                                        <el-button type="primary" @click="loadAttendanceRecords" size="mini">
                                            <i class="el-icon-search"></i> Êü•ËØ¢
                                        </el-button>
                                        <el-button type="info" @click="exportRecords" size="mini" style="margin-left: 5px;">
                                            <i class="el-icon-download"></i> ÂØºÂá∫
                                        </el-button>
                                    </div>
                                </div>

                                <el-table
                                    :data="attendanceRecords"
                                    stripe
                                    style="width: 100%"
                                    v-loading="loadingRecords"
                                    empty-text="ÊöÇÊó†ËÄÉÂã§ËÆ∞ÂΩï"
                                >
                                    <el-table-column prop="student_id" label="Â≠¶Âè∑" width="120" sortable></el-table-column>
                                    <el-table-column prop="student_name" label="ÂßìÂêç" width="120" sortable></el-table-column>
                                    <el-table-column prop="check_time" label="ÊâìÂç°Êó∂Èó¥" width="180" :formatter="formatTableTime" sortable></el-table-column>
                                    <el-table-column prop="detection_method" label="Ê£ÄÊµãÊñπÊ≥ï" width="120">
                                        <template slot-scope="scope">
                                            <el-tag size="mini" :type="getMethodTagType(scope.row.detection_method)">
                                                {{ getMethodDisplayName(scope.row.detection_method) }}
                                            </el-tag>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="confidence" label="ËØÜÂà´ÁΩÆ‰ø°Â∫¶" width="120" sortable>
                                        <template slot-scope="scope">
                                            <el-progress
                                                :percentage="Math.round(scope.row.confidence * 100)"
                                                :color="getProgressColor(scope.row.confidence * 100)"
                                                :stroke-width="6"
                                                :show-text="true"
                                            ></el-progress>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="liveness_score" label="Ê¥ª‰ΩìÂàÜÊï∞" width="120" sortable>
                                        <template slot-scope="scope">
                                            <el-progress
                                                :percentage="Math.round(scope.row.liveness_score * 100)"
                                                :color="getProgressColor(scope.row.liveness_score * 100)"
                                                :stroke-width="6"
                                                :show-text="true"
                                            ></el-progress>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="status" label="Áä∂ÊÄÅ" width="100">
                                        <template slot-scope="scope">
                                            <el-tag type="success" size="mini">{{ scope.row.status }}</el-tag>
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </el-card>
                        </div>
                    </el-tab-pane>
                </el-tabs>
            </el-main>
        </el-container>

        <!-- Â≠¶ÁîüËØ¶ÊÉÖÂØπËØùÊ°Ü -->
        <el-dialog
            title="Â≠¶ÁîüËØ¶ÊÉÖ"
            :visible.sync="studentDetailDialogVisible"
            width="500px"
        >
            <div v-if="selectedStudent">
                <el-descriptions :column="1" border>
                    <el-descriptions-item label="Â≠¶Âè∑">{{ selectedStudent.student_id }}</el-descriptions-item>
                    <el-descriptions-item label="ÂßìÂêç">{{ selectedStudent.name }}</el-descriptions-item>
                    <el-descriptions-item label="Áè≠Á∫ß">{{ selectedStudent.class_name }}</el-descriptions-item>
                    <el-descriptions-item label="‰∫∫ËÑ∏Áä∂ÊÄÅ">
                        <el-tag :type="selectedStudent.has_face_encoding ? 'success' : 'warning'">
                            {{ selectedStudent.has_face_encoding ? 'Â∑≤ÂΩïÂÖ•' : 'Êú™ÂΩïÂÖ•' }}
                        </el-tag>
                    </el-descriptions-item>
                    <el-descriptions-item label="‰∫∫ËÑ∏Ë¥®ÈáèÂàÜÊï∞">
                        <span v-if="selectedStudent.face_quality_score">
                            {{ (selectedStudent.face_quality_score * 100).toFixed(1) }}%
                        </span>
                        <span v-else>-</span>
                    </el-descriptions-item>
                    <el-descriptions-item label="Ê≥®ÂÜåÊó∂Èó¥">{{ formatTime(selectedStudent.created_at) }}</el-descriptions-item>
                </el-descriptions>
            </div>
            <span slot="footer" class="dialog-footer">
                <el-button @click="studentDetailDialogVisible = false">ÂÖ≥Èó≠</el-button>
            </span>
        </el-dialog>
    </div>

    <!-- ÂºïÂÖ•VueÂíåElement UI -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.14/vue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.15.13/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script src="utils.js"></script>
    <script src="main.js"></script>
</body>
</html>